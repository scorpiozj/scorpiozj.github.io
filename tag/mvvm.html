<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Scorpiozj: To be Independent</title>
    <meta name="description" content="">
    <meta name="author" content="Charles Zhu">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="/theme/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.1.1/css/bootstrap.no-icons.min.css" rel="stylesheet">
    <link href="/theme/local.css" rel="stylesheet">
    <link href="/theme/pygments.css" rel="stylesheet">
    <link href="/theme/font-awesome.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Gudea:400,400italic|Alegreya+SC' rel='stylesheet' type='text/css'>
</head>

<body>
<header class="blog-header">
  <div class="container">
    <div class="row-fluid">
      <div class="span9">
	<a href="" class="brand">Scorpiozj: To be Independent</a>
      </div>

      <div class="span3" id="blog-nav">
	<ul class="nav nav-pills pull-right">
	    <li >
	      <a href="/category/design.html ">Design</a>
	    <li >
	      <a href="/category/ios.html ">iOS</a>
	    <li >
	      <a href="/category/linux.html ">Linux</a>
	</ul>
      </div>
    </div> <!-- End of fluid row-->
  </div>   <!-- End of Container-->
</header>
    
<div class="container">
    <div class="content">
    <div class="row-fluid">

        <div class="span10">
        

        

    <div class='row-fluid''>
        <div class="article-title span9">
            <a href="/mvvmchu-shi-jian.html"><h1>MVVM初实践</h1></a>
        </div>
    </div>
    <div class="row-fluid">
      <div class="span2">
<p>Mon 25 August 2014 </p>

<p style="text-align: left;">
Filed under <a href="/category/ios.html">iOS</a>
</p>
<p style="text-align: left;">
 
    Tags <a href="/tag/mvvm.html">MVVM</a> </p>
<p>
</p>
      </div>
      <div class="article-content span8">
	<p>Author: Charles Zhu<br />
Summary: a sample project practising MVVM</p>
<p>之前已经初步了解了一些MVVM的概念，需要在实践中体会这种设计模式，并理解“响应式”带来的优越性。<br />
考虑到最近一直在做网盘类产品，于是决定：获取网盘的内容，并可以浏览内容。如果是文件夹的话，则可以点击查看内容。这样，就相当于实现了一个小型的文件查看器。<br />
另外需要说明的，这里的网盘其实是一个带有系统的SD卡，自身带有AP，可以无线连接访问。同时，提供了API接口获取相关的数据。</p>
<h3>MVVM 的角色分配</h3>
<p>视图无疑是用<code>UITableView</code>, 控制器自然选择<code>UITableViewController</code>,自然这里需要建立一个<code>ViewModel</code>来监视一切变化并把这种变化传递给控制器。</p>
<h3>已知的VM任务</h3>
<ol>
<li>获取文件夹列表
 VM需要知道当前所在的路径。另外获取到的数据需要重组：比如去掉隐藏文件，进行排序等。这个操作可以封装在某个数据访问层。</li>
<li>cell的点击操作
对于文件，需要把文件内容显示出来(为了方便，这里只对图片文件显示)。  </li>
</ol>
<h3>控制器的任务</h3>
<p>显示页面，以及点击cell时的页面切换。</p>
<h3>VM的内容</h3>
<ol>
<li><code>UITableView</code>的 <code>dataSource</code>
dataSource相应的接口需要由VM来实现。在实现cell的时候，cell上的文件名也要通过VM来获取</li>
<li>数据获取的时机
一般是在VM的信号didBecomeActiveSignal中去注册相应的事件。当事件完成后（获取列表任务），发送更新signal去通知控制器更新页面，因此在控制器中也要注册更新signal收到时相应的事件。整个伪代码逻辑：  <div class="highlight"><pre><span class="c1">//ViewController</span>
    <span class="err">@</span><span class="n">weakify</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
<span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">updatedContentSignal</span> <span class="n">subscribeNext</span><span class="o">:^</span><span class="p">(</span><span class="kt">id</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
<span class="err">@</span><span class="n">strongify</span><span class="p">(</span><span class="n">self</span><span class="p">);</span>
<span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">tableView</span> <span class="n">reloadData</span><span class="p">];</span>
<span class="p">}];</span>

<span class="c1">//ViewModel</span>
<span class="n">self</span><span class="p">.</span><span class="n">updatedContentSignal</span> <span class="o">=</span> <span class="p">[[</span> <span class="n">RACSubject</span> <span class="n">subject</span><span class="p">]</span> <span class="n">setNameWithFormat</span><span class="o">:</span><span class="s">@&quot;%@_MasterVC&quot;</span><span class="p">,</span><span class="n">self</span><span class="p">.</span><span class="n">directory</span><span class="p">];</span>
<span class="n">self</span><span class="p">.</span><span class="n">flashCommand</span> <span class="o">=</span> <span class="p">[[</span><span class="n">RACCommand</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">initWithSignalBlock</span><span class="o">:^</span><span class="n">RACSignal</span> <span class="o">*</span><span class="p">(</span><span class="kt">id</span> <span class="n">input</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="n">defer</span><span class="o">:^</span><span class="n">RACSignal</span> <span class="o">*</span><span class="p">{</span>
        <span class="c1">//get content list</span>

        <span class="c1">//finish data fetching and send signal</span>

        <span class="p">[(</span><span class="n">RACSubject</span> <span class="o">*</span><span class="p">)</span><span class="n">self</span><span class="p">.</span><span class="n">updatedContentSignal</span> <span class="n">sendNext</span><span class="o">:</span><span class="nb">nil</span><span class="p">];</span>
        <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="p">}];</span>
<span class="p">}];</span>

<span class="err">@</span><span class="n">weakify</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
<span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">didBecomeActiveSignal</span> <span class="n">subscribeNext</span><span class="o">:^</span><span class="p">(</span><span class="kt">id</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
<span class="err">@</span><span class="n">strongify</span><span class="p">(</span><span class="n">self</span><span class="p">);</span>
<span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">flashCommand</span> <span class="n">execute</span><span class="o">:</span><span class="p">[</span><span class="n">NSNull</span> <span class="n">null</span><span class="p">]];</span>
<span class="p">}];</span>
</pre></div>


</li>
</ol>
<h3>Cell的点击</h3>
<p>由于有文件和文件夹的区别，cell无法在storyboard中创建2个push的segue，所以先利用对于文件夹的点击在<code>UITableView</code>的点击delegate事件中进行操作，而文件的点击则通过<code>performSegueWithIdentifier</code>来实现。</p>
<h3>总结</h3>
<p>总体来说，实践基本按循MVVM的原则来进行，控制器中的内容变得很清爽，基本上只包含对view的控制，和VM的通信则是通过响应式的方式实现的。同时VM中包含了很多数据处理的内容，基本上逻辑的部分都转移到了VM中进行。在这种情况下，一个controller就要配一个VM，不知道会不会又造成VM的臃肿？</p> 
	<a class="btn btn-mini xsmall" href="/mvvmchu-shi-jian.html">
          <i class="icon-comment"></i> Comment </a>
	<hr />
      </div>
      
    </div>
    

 
        



    <div class='row-fluid'>
      <div class='article-title span9'> 
        <a href="/mvvmmo-shi-chu-tan.html"><h1>MVVM模式初探</h1></a>
      </div>
    </div>
    <div class="row-fluid">
      <div class="span2">
<p>Thu 17 July 2014 </p>

<p style="text-align: left;">
Filed under <a href="/category/ios.html">iOS</a>
</p>
<p style="text-align: left;">
 
    Tags <a href="/tag/ios.html">iOS</a> <a href="/tag/mvvm.html">mvvm</a> <a href="/tag/mvc.html">mvc</a> <a href="/tag/pattern.html">pattern</a> </p>
<p>
</p>
      </div>
      <div class="summary span8">
	<p>Author: Charles Zhu<br />
Summary: 设计模式</p>
<h2>MVC的无奈</h2>
<p><a href="https://developer.apple.com/library/ios/documentation/General/Conceptual/CocoaEncyclopedia/Model-View-Controller/Model-View-Controller.html">MVC</a>结构是学习iOS开发的人最先学习的一种开发模式，apple提倡以MVC为中心的开发模式。因为它很好的解构了应用场景中相关而又各自独立的部分：视图，视图控制器和数据模型。在MVC的世界里，控制器负责将模型中的数据以内容的形式展现到视图中，同时也把视图上产生的数据变化传递给模型从而将这种变化持久化。于是，在稍微复杂的app中，控制器中的内容会很庞大：网络操作，数据存储，手势响应等等。几乎可以确定，如果app需要添加新功能，超过一半的新增代码是添加在控制器中，这样不可避免的造成控制器的冗余以及大段无法重用的重复代码。<br />
在开始MVVM时，我们可以稍稍考虑下现有MVC的问题。</p>
<h3>视图</h3>
<p>毋庸置疑，视图的作用很重要，但在设计中，视图是否需要和控制器，数据模型同等的地位呢？要知道绝大多数情况下，视图是不会重用的，往往“耦合”在视图控制器中，所以往往代码中有几个view controller，就能知道程序会有几个页面。此外，视图中的UI元素也是直接作为变量存在在控制器代码中，因为只有这样才方便刷新。很显然，视图控制器就可以代表视图本身。  </p>
<h3>控制器</h3>
<p>控制器需要把模型代表的数据以合适的形式显示在视图上，这样免不了需要处理（当然也有不需要处理的简单情况 ...</p> 
	<a class="btn btn-mini xsmall" href="/mvvmmo-shi-chu-tan.html">
          <i class="icon-plus-sign"></i> Read More </a>
	<hr />
      </div>
      
    </div>
      
<div class="pagination">
<ul>
    <li class="prev disabled"><a href="#">&larr; Previous</a></li>

    <li class="active"><a href="/tag/mvvm.html">1</a></li>

    <li class="next disabled"><a href="#">&rarr; Next</a></li>

</ul>
</div>
 
  
        </div>
        
        
    </div>     </div> </div>

<!--footer-->
<div class="container">
  <div class="well" style="background-color: #E9EFF6">
    <div id="blog-footer">
      <div class="row-fluid">
	<div class="social span2" align="center" id="socialist">
	  <ul class="nav nav-list">
	    <li class="nav-header">
	      Social
	    </li>
	    <li><a href="#"><i class="icon-You can add links in your config file" style="color: #1f334b"></i>You can add links in your config file</a></li>
	    <li><a href="#"><i class="icon-Another social link" style="color: #1f334b"></i>Another social link</a></li>

	  </ul>
	</div>
        <div class="links span2" align="center">
          <ul class="nav nav-list">
            <li class="nav-header"> 
              Links
            </li>
            
            <li><a href="http://getpelican.com/">Pelican</a></li>
            <li><a href="http://python.org/">Python.org</a></li>
            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
            <li><a href="#">You can modify those links in your config file</a></li>
          </ul>
        </div>
	<div class="site-nav span2" align="center">
          <ul class="nav nav-list" id="site-links">
            <li class="nav-header"> 
              Site
            </li>
            <li><a href=""><i class="icon-home" style="color: #1f334b">
                </i>Home</a></li>
            <li><a href="/archives.html"><i class="icon-list" style="color: #1f334b">
                </i>Archives</a></li>
	    <li><a href="/tags.html"><i class="icon-tags" style="color: #1f334b">
                </i>Tags</a></li>
	    
            <li><a href="/" rel="alternate">
                <i class="icon-rss-sign" style="color: #1f334b"></i>
                Atom Feed</a></li>
	  </ul>

        </div>

      </div> <!--end of fluid row-->
    </div> <!--end of blog-footer-->
    <hr />
    <p align="center"><a href="">Scorpiozj: To be Independent</a>
      &copy; Charles Zhu
    Powered by <a href="github.com/getpelican/pelican">Pelican</a> and
        <a href="https://twitter.github.com/bootstrap">Twitter Bootstrap</a>. 
        Icons by <a href="http://fortawesome.github.com/Font-Awesome">Font Awesome</a> and 
        <a href="http://gregoryloucas.github.com/Font-Awesome-More">Font Awesome More</a></p>

  </div> <!--end of well -->
</div> <!--end of container -->

<!--/footer-->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/js/bootstrap.min.js"></script>



</body>
</html>